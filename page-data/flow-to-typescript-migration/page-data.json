{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/flow-to-typescript-migration/","result":{"data":{"markdownRemark":{"id":"ea87285d-d0cf-5da3-a050-2d56aba3bf7a","excerpt":"Over the last couple of years, I have been migrating several large codebases from Flow to TypeScript with minimal effort. In this post, I will describe my motivation and the approach I would recommend‚Ä¶","html":"<p>Over the last couple of years, I have been migrating several large codebases from Flow to TypeScript with minimal effort. In this post, I will describe my motivation and the approach I would recommend.</p>\n<h2>Motivation</h2>\n<p>I started using Flow around 2014. Back then, it was easier to introduce Flow in an existing codebase. Throughout the years, Flow really served the projects I was working on.</p>\n<p>But as the TypeScript community and tooling have been improving rapidly since, I decided to abandon Flow back in the fall of 2018.</p>\n<p>My primary motivation:</p>\n<ul>\n<li>in most editors (notably Visual Studio Code) TypeScript shines: auto import, refactoring, quick error reporting out of the box</li>\n<li>more well-maintained and more people working on improving TypeScript (quick and dirty metric would be TODO)</li>\n<li>easier to onboard new people to a codebase as it is more familiar and the online material is vast</li>\n<li>more third-party types can be found, and more libraries are written in TypeScript (naturally improving the quality of the interface types)</li>\n<li>while trying out TypeScript on Flow codebases I found type-related bugs</li>\n<li>too often I‚Äôve discovered Flow silently bailing out type checking. I have not experienced this with TypeScript</li>\n<li>installing types using npm (DefinelyTyped) makes a lot of sense compared to flow-typed where type definitions are checked into your repository</li>\n<li>the feature sets and syntax are very comparable</li>\n<li>I have experienced Flow running out of memory when type checking a React Native projects. It was a real defeat that I needed to disable type-checking on CI as we ran out of memory. ü§¶üèº‚Äç‚ôÇÔ∏è</li>\n</ul>\n<h2>Approach</h2>\n<p>I tried out a bunch of different codemods, that automates the refactoring from Flow to TypeScript. If the concept of automated refactoring with codemods is new to you, you might find <a href=\"https://www.youtube.com/watch?v=eMI0UBav8Q4\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this talk</a> interesting.</p>\n<p>The best codemod I found is khan academy‚Äôs <code class=\"language-text\">flow-to-ts</code>. TODO</p>\n<h3>A word on code reviews</h3>\n<p>For each of the following steps, I recommend that you make a separate commit, as this will make the code review easier‚Ä¶ And as you will end up changing most files in your project, it will be difficult to review.</p>\n<h3>Prepare your codebase</h3>\n<p>Before running flow-to-ts it might be nice to prepare your codebase:</p>\n<ol>\n<li>remove any checked in types and config: <code class=\"language-text\">rm -rf flow-typed .flowconfig</code></li>\n<li>install TypeScript package: <code class=\"language-text\">yarn add --dev typescript</code> / <code class=\"language-text\">npm install --save-dev typescript</code></li>\n<li>remove Flow package: <code class=\"language-text\">yarn remove flow-bin</code> / <code class=\"language-text\">npm remove flow-bin</code></li>\n<li>setup a <code class=\"language-text\">tsconfig.json</code> file (TODO)</li>\n<li>update your linter to support TypeScript (I would recommend <code class=\"language-text\">eslint</code>). You might need to specify the <code class=\"language-text\">ts</code> and <code class=\"language-text\">tsx</code> file extensions (i.e. <code class=\"language-text\">eslint --ext=jsundefinedtsundefinedtsx .</code>).</li>\n</ol>\n<h3>Migrate all the things!</h3>\n<p>Run <em>flow-to-ts code transformation</em>:</p>\n<ol>\n<li>run flow-to-ts: <code class=\"language-text\">npx ...</code></li>\n<li>commit</li>\n<li>try compiling the project with <code class=\"language-text\">tsc</code> and fix each problem you encounter*</li>\n</ol>\n<p>*) If you find a lot of issues here that you should be able to automate your way out of, then it might be worth creating an issue at flow-to-ts (and make a contribution).</p>\n<p>Reminder to:</p>\n<ul>\n<li>remove flow suppression comments</li>\n<li>-</li>\n</ul>\n<p>The first time I migrated a codebase, I did my own very <a href=\"https://gist.github.com/skovhus/c57367ce6ecbc3f70bb7c80f25727a11\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">quick and dirty codemod</a> with some regular expressions. It shows that it is fairly easy to get 80% of the way, but I really like the nice packaging that <code class=\"language-text\">flow-to-ts</code> comes with.</p>\n<h2>How much time does it take?</h2>\n<p>It all depends on the quality of your Flow types, the libraries you use, and the size of your codebase.</p>\n<p>I converted a 30K lines React Native app in a few days. While doing this I uncovered a few potential bugs that TypeScript found.</p>\n<h2>What is a codemod?</h2>\n<hr>\n<p><em>Thanks to <a href=\"https://twitter.com/penzington\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Maciek Pekala</a> for reviewing this post.</em></p>","timeToRead":3,"frontmatter":{"title":"Migrating a codebase from Flow to TypeScript using flow-to-ts","date":"February 10, 2020","description":null,"devToLink":null,"featuredImage":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAgAE/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAARneKaEJP//EAB0QAAECBwAAAAAAAAAAAAAAAAECMQADBBETITP/2gAIAQEAAQUCVdczFovV9yxj/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGRAAAgMBAAAAAAAAAAAAAAAAARAAAhEx/9oACAEBAAY/AtsMnUX/AP/EABoQAAMBAQEBAAAAAAAAAAAAAAABESExUWH/2gAIAQEAAT8hstY4atZhhkzMfEO0s+HR/9oADAMBAAIAAwAAABAzz//EABURAQEAAAAAAAAAAAAAAAAAABAx/9oACAEDAQE/EKf/xAAVEQEBAAAAAAAAAAAAAAAAAAAQMf/aAAgBAgEBPxCH/8QAHRABAAICAgMAAAAAAAAAAAAAAQARITFBUXGh4f/aAAgBAQABPxAvtUgxVhV86iWQgOvuphDI8RK1Sr6IpKlo+MwmPRP/2Q==","width":500,"height":500,"src":"/static/135bff67859e703598a2c027c74cc3c1/d361f/flow-to-typescript-migration.jpg","srcSet":"/static/135bff67859e703598a2c027c74cc3c1/d361f/flow-to-typescript-migration.jpg 1x,\n/static/135bff67859e703598a2c027c74cc3c1/9f181/flow-to-typescript-migration.jpg 1.5x,\n/static/135bff67859e703598a2c027c74cc3c1/c68bd/flow-to-typescript-migration.jpg 2x"}}}}},"site":{"siteMetadata":{"siteUrl":"https://skovhus.github.io"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/flow-to-typescript-migration/","previous":{"fields":{"slug":"/software-engineering-principles/"},"frontmatter":{"title":"Software Engineering Principles"}},"next":null}}}