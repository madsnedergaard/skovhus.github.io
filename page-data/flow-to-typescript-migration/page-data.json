{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/flow-to-typescript-migration/","result":{"data":{"markdownRemark":{"id":"ea87285d-d0cf-5da3-a050-2d56aba3bf7a","html":"<p>Over the last couple of years, I have been migrating several codebases from <a href=\"https://flow.org/en/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Flow</a> to <a href=\"https://www.typescriptlang.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">TypeScript</a> with minimal effort. In this post, I will describe my motivation and the approach I would recommend.</p>\n<p><em>TL;DR I recommend migrating using the <a href=\"https://github.com/Khan/flow-to-ts\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">flow-to-ts</a> codemod by Khan Academy.</em></p>\n<h2>Motivation</h2>\n<p>I started using Flow shortly after it was open sourced by Facebook in <a href=\"https://engineering.fb.com/web/flow-a-new-static-type-checker-for-javascript/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">2014</a>. It supports many of the same features as TypeScript (open sourced by Microsoft 2012) but focuses on being a static type checker where TypeScript is also a compiler. I originally picked it over TypeScript due to the momentum in the React community and the easy gradual migration path for existing code.</p>\n<p>But as the TypeScript community and tooling have been rapidly improving, I decided to abandon the Flow ship. This also seems to be a trend in the open source community (example: <a href=\"https://github.com/facebook/jest/issues/7807\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Jest</a>, <a href=\"https://dev.to/arcanis/introducing-yarn-2-4eh1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Yarn</a>, and <a href=\"https://github.com/expo/expo/issues/2164\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Expo</a>).</p>\n<p>My primary motivation for moving to TypeScript:</p>\n<ul>\n<li>TypeScript seems more <strong>well-maintained</strong> and more people working on it: In January 2020 TypeScript had 29 contributors, Flow had 14 contributors, and there were 156 pull requests merged compared to no Flow pull requests merged</li>\n<li>in my experience, it is easier to onboard new people to a TypeScript codebase as it is <strong>more widely used and the online material is vast</strong></li>\n<li>in most <strong>editors</strong> (notably Microsoft‚Äô Visual Studio Code) TypeScript shines: auto import, refactoring, quick error reporting out of the box</li>\n<li>more <strong>third-party types</strong> are available (estimated to roughly 8X)</li>\n<li>more <strong>libraries are written in TypeScript</strong> (naturally improving the quality of the interface types compared to reserve engineering the types)</li>\n<li>too often I‚Äôve discovered <strong>Flow silently bailing</strong> out type checking, I have not experienced this with TypeScript</li>\n<li>although Flow should be more <a href=\"https://github.com/facebook/flow/issues/7365#issuecomment-454956694\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><em>sound</em> by design</a>, I uncovered <strong>type-related bugs</strong> after migrating a codebase from Flow (maybe related to Flow silently bailing out type checking)</li>\n<li><strong>installing types using npm</strong> / <a href=\"https://github.com/DefinitelyTyped/DefinitelyTyped\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">DefinitelyTyped</a> makes a lot of sense compared to <a href=\"https://github.com/flow-typed/flow-typed\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">flow-typed</a> where type definitions are checked into your repository (and you forget to update them)</li>\n<li>the feature sets and syntax are very comparable, so <strong>migration is easy</strong> (see this great <a href=\"https://github.com/niieani/typescript-vs-flowtype\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">comparison</a>)</li>\n<li>I have experienced <strong>Flow running out of memory</strong> when type checking a React Native projects. It was a real defeat that I needed to disable type-checking on CI as we ran out of memory. ü§¶üèº‚Äç‚ôÇÔ∏è</li>\n</ul>\n<h2>Approach</h2>\n<p>I tried out a bunch of different tools (codemods), that automates the refactoring from Flow to TypeScript. If the concept of automated refactoring with codemods is new to you, you might find <a href=\"https://www.youtube.com/watch?v=eMI0UBav8Q4\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">a talk I gave on the topic</a> interesting.</p>\n<p>The best migration tool I have found is Khan Academy‚Äôs <a href=\"https://github.com/Khan/flow-to-ts\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">flow-to-ts</a>. From their README:</p>\n<blockquote>\n<p>The goal of this project is to provide a tool that can translate 95% of Flow to TypeScript while maintaining a high percentage of the existing type information.</p>\n</blockquote>\n<p><strong>‚ö†Ô∏è A word on code reviews</strong>: You will end up changing most files in your project, so it will be difficult to review. To make this process as easy as possible, I recommend that you make a separate commit for each of the following steps.</p>\n<h3>Step 1: Prepare your codebase</h3>\n<p>Before running flow-to-ts I recommend preparing your codebase for type-checking using  TypeScript.</p>\n<ol>\n<li>Remove any checked-in types (typically in a flow-typed folder) and config:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">rm</span> -rf flow-typed .flowconfig</code></pre></div>\n<ol start=\"2\">\n<li>\n<p>Install the TypeScript package:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> --dev typescript\n<span class=\"token comment\"># or</span>\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev typescript</code></pre></div>\n</li>\n<li>Remove the Flow package:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> remove flow-bin\n<span class=\"token comment\"># or</span>\n<span class=\"token function\">npm</span> remove flow-bin</code></pre></div>\n<ol start=\"4\">\n<li>Setup a tsconfig.json file for configuring TypeScript. There are many ways to do this, but running <code class=\"language-text\">npx tsc --init</code> is a good start. <a href=\"https://www.typescriptlang.org/docs/handbook/tsconfig-json.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Read more</a> about the configuration file.</li>\n<li>Update your linter to support TypeScript. I would recommend using <a href=\"https://github.com/typescript-eslint/typescript-eslint\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">TypeScript ESlint</a></li>\n<li>\n<p>Update your build setup to support TypeScript. Here are a few pointers for some popular setups:</p>\n<ul>\n<li><a href=\"https://create-react-app.dev/docs/adding-typescript/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Create React App</a></li>\n<li><a href=\"https://devblogs.microsoft.com/typescript/typescript-and-babel-7/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Babel setup</a></li>\n<li><a href=\"https://webpack.js.org/guides/typescript/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Webpack</a></li>\n</ul>\n</li>\n</ol>\n<h3>Step 2: Migrate all the things!</h3>\n<ol>\n<li>Run the flow-to-ts code transformation:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Replace src with your source folder or a glob</span>\nnpx @khanacademy/flow-to-ts --write --delete-source src</code></pre></div>\n<ol start=\"2\">\n<li>[Optional] If you use a code formatter (like <a href=\"https://prettier.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Prettier</a>) then format your new codebase</li>\n<li>Commit the changes (e.g. ‚ÄúMigrate to TypeScript using flow-to-ts codemod‚Äù)</li>\n<li>This is the most <strong>time-consuming</strong> part: try compiling the project with TypeScript and fix each problem you encounter:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">npx tsc --noEmit -p <span class=\"token builtin class-name\">.</span></code></pre></div>\n<p>Start from the top and move your way through‚Ä¶ It will take some time. You probably need to install a bunch of types for your libraries (e.g. <code class=\"language-text\">@types/react</code>).</p>\n<p>If you find yourself doing a lot of repetitive fixes, please share these in an issue over at the <a href=\"https://github.com/Khan/flow-to-ts\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">flow-to-ts repository</a> and help improve the codemod.</p>\n<ol start=\"5\">\n<li>Finally, when everything compiles again, check that you can lint and build your project</li>\n<li>ü•Ç</li>\n<li>[Optional] You can now remove any <a href=\"https://flow.org/en/docs/config/options/#toc-suppress-comment-regex\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Flow suppression comments</a> (e.g. <code class=\"language-text\">$FlowFixMe</code>)</li>\n<li>[Optional] Some Flow utility types are replaced by the <a href=\"https://github.com/piotrwitek/utility-types\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">utility-types</a> package. You can get rid of some of them if you like (e.g. <code class=\"language-text\">$Keys&lt;T&gt;</code> can be replaced by <code class=\"language-text\">keyof T</code>).</li>\n</ol>\n<h2>How much effort does it take?</h2>\n<p>It all depends on the quality of your Flow types, the libraries you use, and the size of your codebase.</p>\n<p>With the flow-to-ts codemod, you can quickly try out TypeScript on an existing codebase and assess how much work the manual part of the migration would take.</p>\n<p>I converted a 30K lines React Native app in a few days. While doing this, I also spend time fixing a few potential bugs that TypeScript uncovered. üéÅ</p>\n<p>So long Flow! üëã And thanks for all the checking + healthy competition in the static type space.</p>\n<hr>\n<p><em>Thanks to <a href=\"https://twitter.com/mads_hartmann\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Mads Hartmann</a> for reviewing this post.</em></p>","timeToRead":6,"frontmatter":{"title":"Migrating from Flow to TypeScript using flow-to-ts","date":"February 09, 2020","description":"Over the last couple of years, I have been migrating several codebases from Flow to TypeScript with minimal effort. In this post, I will describe my motivation and the approach I would recommend.","devToLink":"https://dev.to/kenneth_skovhus/migrating-from-flow-to-typescript-using-flow-to-ts-532p","featuredImage":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMEAgX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAcUdNM685ckuhZBP/8QAHBABAQABBQEAAAAAAAAAAAAAAgESAAMQESNB/9oACAEBAAEFAqfL7ZoqERnvdxz4Ksn/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAcEAABBAMBAAAAAAAAAAAAAAAAARARMTJRYXL/2gAIAQEABj8Cynjx3Qk6LZPJZ//EABwQAQADAQEAAwAAAAAAAAAAAAEAESExUUFx8f/aAAgBAQABPyEQtU0I6RNa89mnR+oWs4PhNy1O0TVaitznv9TGIn//2gAMAwEAAgADAAAAEHD/AAP/xAAVEQEBAAAAAAAAAAAAAAAAAAAgMf/aAAgBAwEBPxCj/8QAFREBAQAAAAAAAAAAAAAAAAAAIDH/2gAIAQIBAT8Qg//EAB8QAQEAAgICAwEAAAAAAAAAAAERACFBUTGRcaHR8P/aAAgBAQABPxCyvWVHt94QCIgLSPc6wjfR8qfWGRYEU8jd84gWqVLa/mOqpBWG/RMEN6Izi/zligjn84hDFunP/9k=","width":500,"height":500,"src":"/static/5c8673848302639f5a0d87f3bdefbedf/d361f/flow-to-typescript-migration.jpg","srcSet":"/static/5c8673848302639f5a0d87f3bdefbedf/d361f/flow-to-typescript-migration.jpg 1x"}}}}},"site":{"siteMetadata":{"siteUrl":"https://skovhus.github.io"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/flow-to-typescript-migration/","previous":{"fields":{"slug":"/software-engineering-principles/"},"frontmatter":{"title":"Software Engineering Principles"}},"next":null}}}