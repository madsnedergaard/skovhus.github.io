{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/type-safe-css-modules-with-flow/","webpackCompilationHash":"b82837b6a1e780870e37","result":{"data":{"markdownRemark":{"id":"4dfa6eb6-f644-5c34-86ed-df24f2bbc0d1","excerpt":"I‚Äôve been dreaming about type safety and editor autocompletion when using CSS Modules. There are a few TypeScript tools for this (see this and this), but I didn‚Ä¶","html":"<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/82781fd79c387e48bc41c57f9f86025a/2f950/css-modules-flow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.87500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABGUlEQVQoz6WSz2qEMBDGfea+R19A8AFEQejBkwUvLkUQESsWVw/ZFcq2cdX1D1LNpKPWZWULFvqRw+RLfsxkJgL/h4Su68qyvKyFTl3X2zDeQ54xNtwIt0VRYLABY56+7+8P0N+Gq6pq2/aaEC0AuINhWWs4yzLHcUzT1HXdMAwEZhjLXlW0gDDpB87zPI7jKIpc1/U87wo0TTMVMt072fwg8+GMFABbNSwMQ8R83w+CIEkSQkiappZloXMpizFbE0PywPPnICL7/Ruln9k5w8cKlFJZliVJUhRFVdWnRaIoapp2PB5G+OsDwkd+2pF3atsv/qtv7SwseZzz3DPcYDAPGWOc8+3zOBs4jP0b2NjX2Rf+9pfgV/cb6hpym38PEJIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CSS Modules + Flow = type safety and editor autocompletion\"\n        title=\"CSS Modules + Flow = type safety and editor autocompletion\"\n        src=\"/static/82781fd79c387e48bc41c57f9f86025a/b9e4f/css-modules-flow.png\"\n        srcset=\"/static/82781fd79c387e48bc41c57f9f86025a/cf440/css-modules-flow.png 148w,\n/static/82781fd79c387e48bc41c57f9f86025a/d2d38/css-modules-flow.png 295w,\n/static/82781fd79c387e48bc41c57f9f86025a/b9e4f/css-modules-flow.png 590w,\n/static/82781fd79c387e48bc41c57f9f86025a/f9b6a/css-modules-flow.png 885w,\n/static/82781fd79c387e48bc41c57f9f86025a/2d849/css-modules-flow.png 1180w,\n/static/82781fd79c387e48bc41c57f9f86025a/2f950/css-modules-flow.png 1600w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">CSS Modules + Flow = type safety and editor autocompletion</figcaption>\n  </figure></p>\n<p>I‚Äôve been dreaming about type safety and editor autocompletion when using <a href=\"https://github.com/css-modules/css-modules\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CSS Modules</a>. There are a few TypeScript tools for this (see <a href=\"https://medium.com/@sapegin/css-modules-with-typescript-and-webpack-6b221ebe5f10\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this</a> and <a href=\"https://github.com/Quramy/typed-css-modules\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this</a>), but I didn‚Äôt find any solid tools for <a href=\"https://flow.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Flow</a>.</p>\n<p><em>TL;DR I‚Äôve made some <a href=\"https://github.com/skovhus/css-modules-flow-types\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">new tools</a>, and when trying them on a codebase I‚Äôm working on, Flow found <strong>a lot of dead code (and potential bugs)</strong></em> üò¨</p>\n<h2>The problems</h2>\n<p>It is quite easy to misspell a class name or forget to update consumers after removing a class in a .css file. As an example, the class <code class=\"language-text\">foo</code> might not be defined in <code class=\"language-text\">Button.css</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/* @flow */</span>\n<span class=\"token keyword\">import</span> styles <span class=\"token keyword\">from</span> <span class=\"token string\">'./Button.css'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Button</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token operator\">&lt;</span>button className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span>foo<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Solutions</h2>\n<p>To teach Flow about CSS Modules file, we can create a definition file <code class=\"language-text\">Button.css.flow</code> containing the class names exposed by <code class=\"language-text\">Button.css</code>. By doing so we can get:</p>\n<ul>\n<li>static type checks showing usage of non existing classes</li>\n<li>editor autocompletion of CSS classes (for editors supporting Flow)</li>\n</ul>\n<p>To generate these .flow files I was thinking of two use cases. One using a simple CLI and another using webpack.</p>\n<h3>Solution: CLI</h3>\n<p><a href=\"https://www.npmjs.com/package/css-modules-flow-types-cli\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">css-modules-flow-types-cli</a> is a CLI that quickly generate .flow files.</p>\n<p>Let us install it:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install --save-dev css-modules-flow-types-cli\n\n# or\n\nyarn install -D css-modules-flow-types-cli</code></pre></div>\n<p>And then just run the CLI on your source directory:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">css-modules-flow-types src</code></pre></div>\n<p>I recommend using the CLI on your CI system (like Travis or Circle) to ensure that all .flow files are up-to-date before running Flow. This will catch potential styling errors before deploying.</p>\n<p>Another use case is quick feedback loop when developing and changing CSS Modules files. The CLI includes a watch mode for this, but I myself would like to avoid having yet another tool that needs to be running while developing. As a lot of people already have webpack running, I did a small loader consuming the tokens from style-loader.</p>\n<h3>Solution: webpack loader</h3>\n<p><a href=\"https://www.npmjs.com/package/css-modules-flow-types-loader\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">css-modules-flow-types-loader</a> is a webpack loader keeping .flow files updated by consuming the tokens from <code class=\"language-text\">style-loader</code>. I recommend using this when developing as part of a webpack-dev-server setup. It will give a small slowdown, as the loader potentially needs write a lot of files.</p>\n<p>To get started:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install --save-dev css-modules-flow-types-loader</code></pre></div>\n<p>Then update your webpack config:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n  test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.css$/</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// or the file format you are using</span>\n  use<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'style-loader'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'css-modules-flow-types-loader'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// right after style-loader</span>\n    <span class=\"token comment\">// Other loaders like css-loader after this:</span>\n    <span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And then sit back and enjoy CSS Modules being type checked by Flow. üç∫</p>\n<p>Please let me know what you think‚Ä¶ And give a little ‚≠êÔ∏è over at <a href=\"https://github.com/skovhus/css-modules-flow-types\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GitHub</a>.</p>\n<p><em>This blog post were originally posted on <a href=\"https://hackernoon.com/type-safe-css-modules-with-flow-dd95e761bbe5\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">hackernoon</a>.</em></p>","frontmatter":{"title":"Type safe CSS Modules with Flow","date":"June 21, 2017","description":"CSS Modules + Flow = type safety and editor autocompletion. Introducing a few open source projects to help you with type safety and editor autocompletion.","featuredImage":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABG0lEQVQoz6WSW0+DQBCF+df+G99JfCAGHoQmXB4UYrgEX5RdkgbaFw0pIAXksniWWrWNTZs4IWT2ZL85wwzC9I8Q2rYty/L9MIqiqOv6PIx7TdMMw9DvAzkU6Odh+AA4UqFAvwiGT9d1MBzH8TTM5ucQzrLMtm1VVUVRNE1zxx/DfTexL5Ltg8N5nidJEsex7/uUUvhDRSPQd3f5e3kzvd6yvmw/OsZ+/DnsOI5lWWEYBkHgeZ7ruoSQ+zkwR15hczfRq2ZDHx699XqVpEm6StEjh2VZliRJ13XDMDRNUxQFCcotFhrGwS228RRdD9u3Z0Ij8hI+hRGJ0IKADrFSbBtVsJ6qqrB2DALJ7w7nefEjvutbFy77l9if6idcg3QNsgRM3AAAAABJRU5ErkJggg==","width":500,"height":500,"src":"/static/82781fd79c387e48bc41c57f9f86025a/40243/css-modules-flow.png","srcSet":"/static/82781fd79c387e48bc41c57f9f86025a/40243/css-modules-flow.png 1x,\n/static/82781fd79c387e48bc41c57f9f86025a/36a4b/css-modules-flow.png 1.5x,\n/static/82781fd79c387e48bc41c57f9f86025a/7175a/css-modules-flow.png 2x"}}}}},"site":{"siteMetadata":{"siteUrl":"https://skovhus.github.io"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/type-safe-css-modules-with-flow/","previous":{"fields":{"slug":"/react-prop-types-to-flow-codemod/"},"frontmatter":{"title":"React PropTypes to Flow codemod"}},"next":{"fields":{"slug":"/converting-an-app-to-react-native/"},"frontmatter":{"title":"Converting an app to React Native‚Ää‚Äî‚ÄäHow to get started"}}}}}